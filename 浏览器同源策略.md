# 浏览器同源策略

浏览器同源策略（Same-Origin Policy）是一个至关重要的安全机制。它限制了来自不同源（origin）的脚本之间的交互，有效防止恶意网站通过脚本访问用户的敏感信息或进行其他危险操作。

## 什么是同源

同源是指协议、域名、端口均相同的两个 URL，下表给出了与 URL http[]()://store.company.com/dir/page.html 的源进行对比的示例：

| URL | 结果	| 原因 |
| ---- | ---- | ---- |
| http[]()://store.company.com/dir2/other.html | 同源 | |
| http[]()://store.company.com/dir/inner/another.html | 同源 | |
| https[]()://store.company.com/secure.html | 不同源 | 协议不同 |
| http[]()://news.company.com/dir/other.html | 不同源 | 域名不同 |
| http[]()://store.company.com:81/dir/etc.html | 不同源 | 端口不同 |

## 什么是跨域

跨域（Cross-Origin）是指在 Web 开发中，当一个页面的文档、脚本或资源（如图像、样式表等）尝试加载其他域的内容时，就发生了跨域。

跨域限制了在 Web 开发中一些重要的操作，这些操作包括但不限于：

- 无法读取非同源页面的文档内容

- 无法发送跨域 AJAX 请求

- 无法访问跨域的 Cookie、LocalStorage 或 SessionStorage

- 无法执行跨域脚本操作

## 跨域解决方案

### JSONP

JSONP（JSON with Padding）的本质是，利用script标签的src属性不受同源策略的影响，通过带有参数和回调函数的url发起一次get请求（这也是jsonp只能发起get请求的原因，因为只有get请求才能把参数和回调函数拼接到url中），服务器将接口返回的数据拼凑到回调函数中，返回给浏览器，浏览器解析执行，从而前端拿到回调函数返回的数据。

示例：

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>
    function fn(data) {
      console.log(data)
    }
  </script>
  <!-- 将非同源服务端请求地址写在script标签的src属性中 -->
  <script src="https://api.map.baidu.com/geocoder/v2/?ak=KOmVjPVUAey1G2E8zNhPiuQ6QiEmAwZu&location=22.580200,113.948680&output=json&callback=fn"></script>
</body>
</html>
```

### CORS

跨域资源共享（Cross-Origin Resource Sharing，CORS）是一种机制，它使用额外的http头来告诉浏览器，让运行在一个origin上的web应用被准许访问来自不同源服务器上的指定资源。当一个资源从该资源本身所在的服务器不同的域，协议或端口请求一个资源时，资源会发起一个跨域HTTP请求。实现CORS的关键是服务器，只要服务器实现了CORS请求，就可以跨源通信了。

CORS的实现方式很简单，当使用XMLHttpRequest发送请求时，浏览器发现该请求不符合同源策略，会给该请求加一个请求头：Origin，，后台进行一系列处理，如果确定接收请求则在返回结果中加入一个响应头：Access-Control-Allow-Origin；浏览器判断响应头中是否包含Origin的值，如果有则浏览器会处理响应，我们就可以拿到响应数据，如果不包含浏览器直接驳回，这时我们无法拿到响应数据。所以CORS的表象是让你觉得它与同源的ajax请求没啥区别，代码完全一样。

### 代理服务器

在同源的服务器端部署一个代理服务器，将跨域请求转发至目标服务器，并将响应返回给客户端。通过代理服务器，可以规避浏览器的同源策略限制。
